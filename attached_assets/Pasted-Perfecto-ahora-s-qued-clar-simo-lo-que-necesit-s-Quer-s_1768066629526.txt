Perfecto, ahora s√≠ qued√≥ clar√≠simo lo que necesit√°s üëç
Quer√©s que Replit te arme el ecosistema completo para poder simular end-to-end:
	‚Ä¢	handler (API / edge)
	‚Ä¢	generaci√≥n de IDs
	‚Ä¢	enqueue en SQS (mockeable)
	‚Ä¢	worker OCR
	‚Ä¢	contratos compartidos
	‚Ä¢	todo reutilizable luego en AWS Lambda real

Te dejo UN SOLO PROMPT, muy preciso, para que Replit entienda que tiene que armar la arquitectura completa, no solo el worker.

‚∏ª

üîß PROMPT √öNICO PARA REPLIT

Arquitectura completa: Handler + SQS + Workers (simulable localmente)

Contexto general

Estamos construyendo una arquitectura KYC event-driven, pensada para AWS Lambda + SQS, pero que debe poder simularse completamente en Replit en modo local.

El objetivo es generar una base reusable para:
	‚Ä¢	API Handler (FastAPI / edge)
	‚Ä¢	Encolado de eventos (SQS real o mock)
	‚Ä¢	Workers asincr√≥nicos (Lambda-style)

El c√≥digo generado debe poder:
	‚Ä¢	correr localmente en Replit (sin AWS)
	‚Ä¢	luego separarse f√°cilmente en Lambdas individuales para AWS

‚∏ª

üéØ OBJETIVO GENERAL

Generar un monorepo Python con:
	1.	API Handler (FastAPI)
	‚Ä¢	recibe POST
	‚Ä¢	valida
	‚Ä¢	genera IDs
	‚Ä¢	publica evento
	‚Ä¢	responde ACK inmediato
	2.	Event Queue (SQS abstraction)
	‚Ä¢	implementaci√≥n mock (in-memory / file)
	‚Ä¢	interfaz id√©ntica a SQS real
	3.	Worker OCR Identity
	‚Ä¢	consume eventos
	‚Ä¢	procesa
	‚Ä¢	publica evento siguiente
	4.	Contratos compartidos
	‚Ä¢	eventos
	‚Ä¢	modelos
	‚Ä¢	IDs
	‚Ä¢	logging

‚∏ª

üß± RESTRICCIONES IMPORTANTES
	‚Ä¢	‚úîÔ∏è Python 3.10+
	‚Ä¢	‚úîÔ∏è FastAPI solo para el handler
	‚Ä¢	‚ùå Workers NO usan FastAPI
	‚Ä¢	‚úîÔ∏è Todo debe poder ejecutarse localmente
	‚Ä¢	‚úîÔ∏è Arquitectura preparada para AWS Lambda + SQS real
	‚Ä¢	‚úîÔ∏è Cada componente desacoplado

‚∏ª

üìÇ ESTRUCTURA DEL PROYECTO (OBLIGATORIA)

kyc_platform/
‚îú‚îÄ‚îÄ api_handler/
‚îÇ   ‚îú‚îÄ‚îÄ main.py                # FastAPI entrypoint
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ documents.py
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ id_generator.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ enqueue.py
‚îÇ   ‚îî‚îÄ‚îÄ schemas.py
‚îÇ
‚îú‚îÄ‚îÄ workers/
‚îÇ   ‚îî‚îÄ‚îÄ ocr_identity/
‚îÇ       ‚îú‚îÄ‚îÄ lambda_function.py
‚îÇ       ‚îú‚îÄ‚îÄ processor.py
‚îÇ       ‚îú‚îÄ‚îÄ detector.py
‚îÇ       ‚îú‚îÄ‚îÄ strategies/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ base.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ dni.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ passport.py
‚îÇ       ‚îî‚îÄ‚îÄ publisher.py
‚îÇ
‚îú‚îÄ‚îÄ queue/
‚îÇ   ‚îú‚îÄ‚îÄ base.py                # Queue interface
‚îÇ   ‚îú‚îÄ‚îÄ mock_queue.py          # Local simulation
‚îÇ   ‚îî‚îÄ‚îÄ sqs_queue.py           # AWS SQS implementation (stub)
‚îÇ
‚îú‚îÄ‚îÄ contracts/
‚îÇ   ‚îú‚îÄ‚îÄ events.py              # Event schemas + versions
‚îÇ   ‚îî‚îÄ‚îÄ models.py              # Shared models
‚îÇ
‚îú‚îÄ‚îÄ runner/
‚îÇ   ‚îî‚îÄ‚îÄ local_pipeline.py      # Simula handler ‚Üí queue ‚Üí worker
‚îÇ
‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îú‚îÄ‚îÄ logging.py
‚îÇ   ‚îî‚îÄ‚îÄ config.py
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md


‚∏ª

1Ô∏è‚É£ API HANDLER (FastAPI)

Endpoint requerido

POST /documents

Responsabilidades
	‚Ä¢	validar input
	‚Ä¢	generar:
	‚Ä¢	document_id
	‚Ä¢	verification_id
	‚Ä¢	persistencia mock (en memoria o archivo)
	‚Ä¢	publicar evento document.uploaded.v1
	‚Ä¢	responder inmediatamente

Response

{
  "ok": true,
  "document_id": "doc_xxx",
  "verification_id": "ver_xxx",
  "status": "queued"
}


‚∏ª

2Ô∏è‚É£ EVENT QUEUE (ABSTRACCI√ìN)

Crear una interfaz gen√©rica:

class EventQueue:
    def publish(event: dict): ...
    def consume() -> list[dict]: ...

Implementaciones
	‚Ä¢	MockQueue ‚Üí para Replit
	‚Ä¢	SQSQueue ‚Üí stub compatible con AWS

‚∏ª

3Ô∏è‚É£ WORKER OCR IDENTITY

Caracter√≠sticas
	‚Ä¢	Lambda-style (lambda_function.py)
	‚Ä¢	consume eventos desde EventQueue
	‚Ä¢	detecta tipo de documento
	‚Ä¢	ejecuta OCR (stub)
	‚Ä¢	publica document.extracted.v1

‚ùå No valida
‚ùå No decide
‚ùå No responde HTTP

‚∏ª

4Ô∏è‚É£ CONTRATOS DE EVENTOS (CR√çTICO)

Ejemplo document.uploaded.v1:

{
  "event": "document.uploaded.v1",
  "document_id": "doc_123",
  "verification_id": "ver_456",
  "client_id": "demo",
  "image_ref": "mock/image.jpg"
}

Ejemplo document.extracted.v1:

{
  "event": "document.extracted.v1",
  "document_id": "doc_123",
  "document_kind": "dni | passport",
  "extracted_data": {},
  "confidence": 0.9
}


‚∏ª

5Ô∏è‚É£ LOCAL PIPELINE RUNNER

Crear un script que:
	1.	Simule POST al handler
	2.	Encole evento
	3.	Ejecute worker
	4.	Muestre eventos generados

Esto es clave para validar el dise√±o sin AWS.

‚∏ª

6Ô∏è‚É£ README (OBLIGATORIO)

Debe explicar:
	‚Ä¢	arquitectura
	‚Ä¢	c√≥mo correr todo en local
	‚Ä¢	c√≥mo separar cada m√≥dulo en Lambda real
	‚Ä¢	c√≥mo reemplazar MockQueue por SQS

‚∏ª

üéØ RESULTADO ESPERADO

Un proyecto que:
	‚Ä¢	simula el flujo completo end-to-end
	‚Ä¢	es 1:1 migrable a AWS Lambda
	‚Ä¢	sirve como plantilla base para TODOS los workers
	‚Ä¢	deja claro qu√© es handler, qu√© es worker y qu√© es infraestructura

‚∏ª

Si quer√©s, despu√©s de que Replit genere esto, el siguiente paso ideal es:
	‚Ä¢	revisar si el dise√±o qued√≥ bien desacoplado
	‚Ä¢	marcar exactamente qu√© carpetas se transforman en Lambdas
	‚Ä¢	o ayudarte a mapear esto a Terraform / SAM / CDK sin cambiar el c√≥digo.